<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">Star`s Blog</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="a blog"><link data-n-head="true" rel="shortcut icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/1141fe0d88674cacf310.js" as="script"><link rel="preload" href="/_nuxt/add5185b4fa9d4c3f8b7.js" as="script"><link rel="preload" href="/_nuxt/bc85665954515c97b03e.js" as="script"><link rel="preload" href="/_nuxt/754a6b386cd0a45a9cd4.js" as="script"><style data-vue-ssr-id="6ab1d7f0:0 2cb398ca:0 17cfdfa9:0 aab9a468:0 7e000e2d:0 435ed019:0 3318e924:0">code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}body,html{margin:0;height:100%}a,a:link{text-decoration:none;color:inherit}p,ul{margin:0;padding:0}li{list-style:none}.md{line-height:1.8}.md h1,.md h2,.md h3,.md h4{margin-top:2em}.md a{color:#961723}.md a:hover{color:#999}.md blockquote{position:relative;margin:1em 0;padding:.5em 40px;background:#f2f2f2}.md blockquote:before{content:"";position:absolute;top:0;bottom:0;left:0;width:10px;background:#ddd}.md p{margin:24px 0}.md li>code,.md p>code{background:#f7f7f7;padding:5px;margin:0 5px;border-radius:5px;font-family:Menlo,Monaco,Courier New,monospace;word-break:break-all;color:#ca342e}.md code{font-size:14px}.md img{display:block;max-width:100%;margin:0 auto}.md ol li{list-style-type:decimal}.md ul li{list-style-type:disc}.md li{margin:4px 0}.md ul{list-style-type:disc;margin-top:1em;margin-bottom:1em;padding-left:40px}.md pre{border-radius:5px}.poem-md p{margin:15px 0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#333}.header[data-v-63d372b8]{text-align:center}.header .header-img[data-v-63d372b8]{margin-top:22px;width:40px}.title[data-v-63d372b8]{max-width:100%;width:600px;margin:100px auto 120px}.title .title-h1[data-v-63d372b8]{font-size:32px;text-align:center;font-weight:400;margin:0}.title .title-date[data-v-63d372b8]{display:flex;align-items:center;justify-content:center;font-size:16px;margin-top:10px;color:#666}.title .title-date-logo[data-v-63d372b8]{margin-right:5px}.body[data-v-63d372b8]{max-width:90%;width:800px;margin:auto;text-align:left;font-size:16px;padding-bottom:100px}.header[data-v-376b395e]{flex:none;height:60px;line-height:60px;border-bottom:1px solid #eee}.header-content[data-v-376b395e]{display:flex;align-items:center;margin:0 auto;max-width:80%;width:650px}.header-text[data-v-376b395e]{position:relative;font-size:20px;display:inline-block;height:100%;font-weight:400;margin:0 0 0 5px}.header-logo[data-v-376b395e]{width:35px;margin-right:5px}.header-nav[data-v-376b395e]{font-size:20px;padding:0;margin:0 0 0 50px}.header-nav-item[data-v-376b395e]{list-style:none}.date-logo[data-v-c75fff14]{height:12px}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="article" data-v-63d372b8><header class="header" data-v-376b395e data-v-63d372b8><nav class="header-content" data-v-376b395e><a href="/" style="display:flex;align-items:center" data-v-376b395e><img src="/_nuxt/img/1c65b4e.png" alt class="header-logo" data-v-376b395e> <h1 class="header-text" data-v-376b395e>Star`s blog</h1></a> <ul class="header-nav" data-v-376b395e><li class="header-nav-item" data-v-376b395e><a href="/poem" style="position:relative" data-v-376b395e>
          Poems
        </a></li></ul></nav></header> <section class="title" data-v-63d372b8><h1 class="title-h1" data-v-63d372b8>Vue和React的重渲染（re-render）机制对比</h1> <p class="title-date" data-v-63d372b8><svg t="1534091825725" fill="currentColor" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2269" xmlns:xlink="http://www.w3.org/1999/xlink" class="date-logo icon title-date-logo" data-v-c75fff14 data-v-63d372b8><defs data-v-c75fff14><style type="text/css" data-v-c75fff14></style></defs><path d="M512 977.454545C255.348364 977.454545 46.545455 768.651636 46.545455 512 46.545455 255.348364 255.348364 46.545455 512 46.545455c102.295273 0 199.354182 32.546909 280.704 94.138182 10.251636 7.761455 12.276364 22.353455 4.514909 32.605091-7.761455 10.228364-22.341818 12.276364-32.605091 4.514909C691.421091 122.379636 604.066909 93.090909 512 93.090909 281.006545 93.090909 93.090909 281.006545 93.090909 512s187.915636 418.909091 418.909091 418.909091 418.909091-187.915636 418.909091-418.909091c0-59.636364-12.264727-117.213091-36.445091-171.147636-5.248-11.729455-0.011636-25.495273 11.717818-30.766545 11.706182-5.259636 25.495273-0.011636 30.766545 11.717818C963.828364 381.777455 977.454545 445.765818 977.454545 512 977.454545 768.651636 768.651636 977.454545 512 977.454545z" p-id="2270" data-v-c75fff14></path><path d="M791.272727 558.545455 512 558.545455c-6.167273 0-12.090182-2.455273-16.453818-6.818909L275.421091 331.613091c-9.088-9.088-9.088-23.819636 0-32.907636 9.076364-9.088 23.831273-9.088 32.907636 0L521.646545 512 791.272727 512c12.846545 0 23.272727 10.426182 23.272727 23.272727S804.119273 558.545455 791.272727 558.545455z" p-id="2271" data-v-c75fff14></path></svg> <span data-v-63d372b8>2018-12-15</span></p></section> <section class="body md" data-v-63d372b8><p>Vue和React的其中一个最重要的区别是它们对于数据更新的管理方式不同，Vue基本上是一套基于getter/setter实现的依赖收集/依赖更新的订阅式机制，而React则是通过显式的触发函数调用来更新数据，比如setState。相比来说Vue的实现方式更细粒度一些， 通过依赖收集，Vue是能够知道一些数据的更新导致了哪些地方需要重新计算的，通过这种机制，Vue能够优雅地实现计算属性、watch，包括视图渲染。而React由于缺少这种细粒度的机制，则更多时候需要一些其它方案来提高性能，于是产生了如PureComponent、ImmutableJS、shouldComponentUpdate钩子等等。</p>
<h3>如何触发组件重渲染？</h3>
<ul>
<li>
<p>Vue：赋值data，如<code>this.value = 3</code></p>
</li>
<li>
<p>React：<code>this.setState({value: 3})</code></p>
</li>
</ul>
<p>其中的区别在于，Vue知道是组件数据中的value字段发生更新了， 而React只知道是组件的State发生了变化，并不知道是什么数据发生了变化。</p>
<h3>Vue的重渲染</h3>
<p>Vue的订阅式机制决定了它不仅知道哪些数据发生了更新，也知道这个数据更新了之后当前组件以及子组件的视图需不需要重新渲染。这是通过“依赖收集”实现的，Vue的视图template会编译成render函数，在数据（data/props/computed）中定义了getter，每次调用各个组件的render函数时，通过getter，就能知道哪些数据被哪些组件的视图所依赖，下一次对这些数据赋值时，也就是调用setter，相应的视图就能触发重渲染，而无关的组件则不需要再次调用render函数，节省了开销。借用Vue作者做的图：（他称之为push式渲染）</p>
<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/vue-push-rendering.png" alt="vue-push-rendering"></p>
<p>举个例子：子组件Child使用了props<code>value</code>进行渲染，父组件Parent将data<code>value</code>作为props传递给了子组件Child，一秒后更新data。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Child.vue</span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token comment">// Parent.vue</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>控制台打印：</p>
<pre class="language-javascript"><code class="language-javascript">Parent render
Parent render
<span class="token comment">//after 1000ms</span>
Child render
Child render
</code></pre>
<p>由于Parent组件和Child组件的视图都使用了Parent的data<code>value</code>，因此改变<code>value</code>的值，父子组件都会进行重渲染。</p>
<p>情况二：
不将<code>value</code>作为props传给子组件Child，只用于组件自身视图：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token comment">// Child.vue</span>
<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>
  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token comment">// Parent.vue</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">""</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>控制台打印：</p>
<pre class="language-javascript"><code class="language-javascript">Parent render
Child render
<span class="token comment">//after 1000ms</span>
Parent render 
</code></pre>
<p>改变value后，父组件重渲染了，而子组件没有重渲染，因为子组件的render函数没有收集到Parent组件的数据<code>value</code>的依赖。</p>
<h3>React的重渲染</h3>
<p>当调用了<code>setState</code>，React并不在乎有什么数据发生了改变，接着触发组件的<code>shouldComponentUpdate</code>，如果返回true则调用<code>render</code>，然后以同样的办法依次更新所有子组件，如果返回<code>false</code>则阻止<code>render</code>方法调用及子组件更新。换句话说，更新视图的控制权由<code>shouldComponentUpdate</code>掌握，而默认情况下该方法返回<code>true</code>。（Vue作者称为pull式渲染）：</p>
<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/react-pull-rendering.png" alt="react-pull-rendering"></p>
<p>看个例子：</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token number">2</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>控制台打印：</p>
<pre class="language-javascript"><code class="language-javascript">Parent render
Child render
Parent render
Child render
</code></pre>
<p>甚至视图什么数据都没使用，调用<code>setState</code>的组件及其子组件就都重渲染了。当组件或节点比较多的时候，更新数据可能会造成很多不必要的虚拟DOM的构建，庞大的节点树也拖慢了diff的速度，这时就需要引入一些优化方案，比如PureComponent配合ImutableJS， PureComponent利用<code>props</code>和<code>state</code>属性的浅对比来决定要不要重渲染，如果浅对比结果是相等，则组件及其子组件不参与重渲染。</p>
</section></div></div></div></div><script>window.__NUXT__={layout:"default",data:[{}],error:null,state:{allArticles:{},article:{name:"compare-vue-react-rendering",title:"Vue和React的重渲染（re-render）机制对比",modified_date:"2018-12-15",document:'<p>Vue和React的其中一个最重要的区别是它们对于数据更新的管理方式不同，Vue基本上是一套基于getter/setter实现的依赖收集/依赖更新的订阅式机制，而React则是通过显式的触发函数调用来更新数据，比如setState。相比来说Vue的实现方式更细粒度一些， 通过依赖收集，Vue是能够知道一些数据的更新导致了哪些地方需要重新计算的，通过这种机制，Vue能够优雅地实现计算属性、watch，包括视图渲染。而React由于缺少这种细粒度的机制，则更多时候需要一些其它方案来提高性能，于是产生了如PureComponent、ImmutableJS、shouldComponentUpdate钩子等等。</p>\n<h3>如何触发组件重渲染？</h3>\n<ul>\n<li>\n<p>Vue：赋值data，如<code>this.value = 3</code></p>\n</li>\n<li>\n<p>React：<code>this.setState({value: 3})</code></p>\n</li>\n</ul>\n<p>其中的区别在于，Vue知道是组件数据中的value字段发生更新了， 而React只知道是组件的State发生了变化，并不知道是什么数据发生了变化。</p>\n<h3>Vue的重渲染</h3>\n<p>Vue的订阅式机制决定了它不仅知道哪些数据发生了更新，也知道这个数据更新了之后当前组件以及子组件的视图需不需要重新渲染。这是通过“依赖收集”实现的，Vue的视图template会编译成render函数，在数据（data/props/computed）中定义了getter，每次调用各个组件的render函数时，通过getter，就能知道哪些数据被哪些组件的视图所依赖，下一次对这些数据赋值时，也就是调用setter，相应的视图就能触发重渲染，而无关的组件则不需要再次调用render函数，节省了开销。借用Vue作者做的图：（他称之为push式渲染）</p>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/vue-push-rendering.png" alt="vue-push-rendering"></p>\n<p>举个例子：子组件Child使用了props<code>value</code>进行渲染，父组件Parent将data<code>value</code>作为props传递给了子组件Child，一秒后更新data。</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Child.vue</span>\n<span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n\n<span class="token comment">// Parent.vue</span>\n<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n        props<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nParent render\n<span class="token comment">//after 1000ms</span>\nChild render\nChild render\n</code></pre>\n<p>由于Parent组件和Child组件的视图都使用了Parent的data<code>value</code>，因此改变<code>value</code>的值，父子组件都会进行重渲染。</p>\n<p>情况二：\n不将<code>value</code>作为props传给子组件Child，只用于组件自身视图：</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token comment">// Child.vue</span>\n<span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n\n<span class="token comment">// Parent.vue</span>\n<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">""</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nChild render\n<span class="token comment">//after 1000ms</span>\nParent render \n</code></pre>\n<p>改变value后，父组件重渲染了，而子组件没有重渲染，因为子组件的render函数没有收集到Parent组件的数据<code>value</code>的依赖。</p>\n<h3>React的重渲染</h3>\n<p>当调用了<code>setState</code>，React并不在乎有什么数据发生了改变，接着触发组件的<code>shouldComponentUpdate</code>，如果返回true则调用<code>render</code>，然后以同样的办法依次更新所有子组件，如果返回<code>false</code>则阻止<code>render</code>方法调用及子组件更新。换句话说，更新视图的控制权由<code>shouldComponentUpdate</code>掌握，而默认情况下该方法返回<code>true</code>。（Vue作者称为pull式渲染）：</p>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/react-pull-rendering.png" alt="react-pull-rendering"></p>\n<p>看个例子：</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        value<span class="token punctuation">:</span> <span class="token number">2</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nChild render\nParent render\nChild render\n</code></pre>\n<p>甚至视图什么数据都没使用，调用<code>setState</code>的组件及其子组件就都重渲染了。当组件或节点比较多的时候，更新数据可能会造成很多不必要的虚拟DOM的构建，庞大的节点树也拖慢了diff的速度，这时就需要引入一些优化方案，比如PureComponent配合ImutableJS， PureComponent利用<code>props</code>和<code>state</code>属性的浅对比来决定要不要重渲染，如果浅对比结果是相等，则组件及其子组件不参与重渲染。</p>\n'},poems:[]},serverRendered:!0}</script><script src="/_nuxt/1141fe0d88674cacf310.js" defer></script><script src="/_nuxt/754a6b386cd0a45a9cd4.js" defer></script><script src="/_nuxt/add5185b4fa9d4c3f8b7.js" defer></script><script src="/_nuxt/bc85665954515c97b03e.js" defer></script>
  </body>
</html>

<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">Star`s Blog</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="a blog"><link data-n-head="true" rel="shortcut icon" href="/favicon.ico"><link rel="preload" href="/_nuxt/09f7093c890e95b279ce.js" as="script"><link rel="preload" href="/_nuxt/304ca3ffca3eb968f2bf.js" as="script"><link rel="preload" href="/_nuxt/58d92c1aa04937a8a387.js" as="script"><link rel="preload" href="/_nuxt/6fc75a689514ac1b59d9.js" as="script"><style data-vue-ssr-id="6ab1d7f0:0 2cb398ca:0 17cfdfa9:0 aab9a468:0 dc2c1fd8:0 435ed019:0">code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}body,html{margin:0;height:100%}a,a:link{text-decoration:none;color:inherit}p,ul{margin:0;padding:0}li{list-style:none}.md{line-height:1.8}.md h1,.md h2,.md h3,.md h4{margin-top:2em}.md a{color:#961723}.md a:hover{color:#999}.md blockquote{position:relative;margin:1em 0;padding:.5em 40px;background:#f2f2f2}.md blockquote:before{content:"";position:absolute;top:0;bottom:0;left:0;width:10px;background:#ddd}.md p{margin:24px 0}.md li>code,.md p>code{background:#f7f7f7;padding:5px;margin:0 5px;border-radius:5px;font-family:Menlo,Monaco,Courier New,monospace;word-break:break-all;color:#ca342e}.md code{font-size:14px}.md img{display:block;max-width:100%;margin:0 auto}.md ol li{list-style-type:decimal}.md ul li{list-style-type:disc}.md li{margin:4px 0}.md ul{list-style-type:disc;margin-top:1em;margin-bottom:1em;padding-left:40px}.md pre{border-radius:5px}.poem-md p{margin:15px 0}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#fff;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}html{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;color:#333}.index-page[data-v-63caee60]{display:flex;flex-flow:column nowrap;min-height:100vh}.main[data-v-63caee60]{flex:auto;max-width:90%;width:600px;margin:60px auto 0}.article-item[data-v-63caee60]{display:block;margin-top:40px}.article-item[data-v-63caee60]:first-child{margin-top:0}.article-item .article-title[data-v-63caee60]{transition:color .2s ease;font-size:24px;font-weight:400;margin:0;color:#333}.article-item .article-date[data-v-63caee60]{display:flex;align-items:center;font-size:14px;margin-top:5px;color:#666}.article-link[data-v-63caee60]{display:block;padding:25px 0}.article-link:hover .article-title[data-v-63caee60]{color:#999}.pagination[data-v-63caee60]{display:flex;align-items:center;justify-content:center;margin-top:80px;font-size:20px}.pagination a[data-v-63caee60]:link,.pagination[data-v-63caee60]{color:#4a4a4a}.pagination .pagination-last[data-v-63caee60],.pagination .pagination-next[data-v-63caee60]{font-size:0;transition:all .5s ease;-webkit-transform:translateX(0);transform:translateX(0);opacity:.9}.pagination .pagination-last.disabled[data-v-63caee60],.pagination .pagination-next.disabled[data-v-63caee60]{transition:none;cursor:default;opacity:.4}.pagination .pagination-last img[data-v-63caee60],.pagination .pagination-next img[data-v-63caee60]{width:40px;opacity:.8}.pagination .pagination-last[data-v-63caee60]{margin-right:20px}.pagination .pagination-last[data-v-63caee60]:not(.disabled):hover{-webkit-transform:translateX(-5px);transform:translateX(-5px)}.pagination .pagination-next[data-v-63caee60]{margin-left:20px}.pagination .pagination-next[data-v-63caee60]:not(.disabled):hover{-webkit-transform:translateX(5px);transform:translateX(5px)}.pagination .pagination-body[data-v-63caee60]{display:inline-block}.pagination .pagination-number[data-v-63caee60]{text-align:center;margin-right:20px;display:inline-block;width:35px;height:35px;transition:all .5s ease;line-height:35px;border-radius:5px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.pagination .pagination-number[data-v-63caee60]:not(.active):hover{background-color:#f2f2f2}.pagination .pagination-number.active[data-v-63caee60]{cursor:default;font-weight:700}.pagination .pagination-number[data-v-63caee60]:last-child{margin-right:0}.footer[data-v-63caee60]{flex:none;overflow:hidden;padding-bottom:50px}.inform[data-v-63caee60]{position:relative;margin:30px 0}.inform .views[data-v-63caee60]{font-size:18px;color:#999}.header[data-v-376b395e]{flex:none;height:60px;line-height:60px;border-bottom:1px solid #eee}.header-content[data-v-376b395e]{display:flex;align-items:center;margin:0 auto;max-width:80%;width:650px}.header-text[data-v-376b395e]{position:relative;font-size:20px;display:inline-block;height:100%;font-weight:400;margin:0 0 0 5px}.header-logo[data-v-376b395e]{width:35px;margin-right:5px}.header-nav[data-v-376b395e]{font-size:20px;padding:0;margin:0 0 0 50px}.header-nav-item[data-v-376b395e]{list-style:none}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div><div class="index-page" data-v-63caee60><header class="header" data-v-376b395e data-v-63caee60><nav class="header-content" data-v-376b395e><a href="/" style="display:flex;align-items:center" data-v-376b395e><img src="/_nuxt/img/1c65b4e.png" alt class="header-logo" data-v-376b395e> <h1 class="header-text" data-v-376b395e>Star`s blog</h1></a> <ul class="header-nav" data-v-376b395e><li class="header-nav-item" data-v-376b395e><a href="/poem" style="position:relative" data-v-376b395e>
          Poems
        </a></li></ul></nav></header> <section class="main" data-v-63caee60><div class="article-item" data-v-63caee60><a href="/e/luofu-poems" class="article-link" data-v-63caee60><h2 class="article-title" data-v-63caee60>洛夫诗摘录</h2> <p class="article-date" data-v-63caee60><span class="article-date-text" data-v-63caee60>2019-09-20</span></p></a></div><div class="article-item" data-v-63caee60><a href="/e/nginx-location" class="article-link" data-v-63caee60><h2 class="article-title" data-v-63caee60>Nginx location 匹配规则</h2> <p class="article-date" data-v-63caee60><span class="article-date-text" data-v-63caee60>2019-09-17</span></p></a></div><div class="article-item" data-v-63caee60><a href="/e/large-file-resume" class="article-link" data-v-63caee60><h2 class="article-title" data-v-63caee60>Web 大文件上传浅析</h2> <p class="article-date" data-v-63caee60><span class="article-date-text" data-v-63caee60>2019-09-11</span></p></a></div><div class="article-item" data-v-63caee60><a href="/e/canvas-concept" class="article-link" data-v-63caee60><h2 class="article-title" data-v-63caee60>canvas的一些概念</h2> <p class="article-date" data-v-63caee60><span class="article-date-text" data-v-63caee60>2019-01-13</span></p></a></div><div class="article-item" data-v-63caee60><a href="/e/compare-vue-react-rendering" class="article-link" data-v-63caee60><h2 class="article-title" data-v-63caee60>Vue和React的重渲染（re-render）机制对比</h2> <p class="article-date" data-v-63caee60><span class="article-date-text" data-v-63caee60>2018-12-15</span></p></a></div></section> <footer class="footer" data-v-63caee60><!----></footer></div></div></div></div><script>window.__NUXT__={layout:"default",data:[{data:{totalPage:1,page:1,items:[{name:"luofu-poems",title:"洛夫诗摘录",modified_date:"2019-09-20",document:"<p>最近读了一些洛夫的诗，其中有些比较喜欢的，摘录在这里。最喜欢的还是那首《泡沫之外》。</p>\n<h2>泡沫之外</h2>\n<p>听完了那人在无定河边钓云的故事<br>\n他便从水中走来<br>\n漂泊的年代<br>\n河到哪里去找它的两岸？</p>\n<p>百日已尽<br>\n岸边的那排柳树并不怎么快乐而月光<br>\n浮贴在水面上<br>\n眼泪便开始在我们体内<br>\n涟漪起来</p>\n<p>战争是一回事<br>\n不朽是另一回事<br>\n臼炮弹与头额在高空互撞<br>\n必然掀起一阵大大的崩溃之风<br>\n于是乎<br>\n这边一座铜像<br>\n那边一座铜像</p>\n<p>而我们的确只是一堆<br>\n不为什么而闪烁的<br>\n泡沫</p>\n<h2>因为风的缘故</h2>\n<p>昨日我沿着河岸<br>\n漫步到<br>\n芦苇弯腰喝水的地方<br>\n顺便请烟囱<br>\n在天空为我写一封长长的信<br>\n潦是潦草了些<br>\n而我的心意<br>\n则明亮亦如你窗前的烛光<br>\n稍有暧昧之处<br>\n势所难免<br>\n因为风的缘故</p>\n<p>此信你能否看懂并不重要<br>\n重要的是<br>\n你务必在雏菊尚未全部凋零之前<br>\n赶快发怒，或者发笑<br>\n赶快从箱子里找出我那件薄衫子<br>\n赶快对镜梳你那又黑又柔的妩媚<br>\n然后以整生的爱<br>\n点燃一盏灯<br>\n我是火<br>\n随时可能会熄灭<br>\n因为风的缘故</p>\n<h2>杭州纸扇</h2>\n<p>（刷的一声）<br>\n知<br>\n乎<br>\n水<br>\n月<br>\n诗人信手题的四个大字<br>\n便如西子动情的小腹<br>\n在哗哗的水声中<br>\n赤裸地<br>\n一一展现</p>\n<p>收拢纸扇<br>\n细腰的苏堤<br>\n又一寸寸地<br>\n折进了<br>\n梦中的晚秋</p>\n<p>你最好把扇子搁在窗口<br>\n风来时<br>\n当可听到隔世的啁啾<br>\n那便是<br>\n柳浪闻莺</p>\n<h3>子夜读信</h3>\n<p>子夜的灯<br>\n是一条未穿衣裳的<br>\n小河</p>\n<p>你的信像一尾鱼游来<br>\n读水的温暖<br>\n读你额上动人的鳞片<br>\n读江河如读一面镜<br>\n读镜中你的微笑<br>\n如读泡沫</p>\n"},{name:"nginx-location",title:"Nginx location 匹配规则",modified_date:"2019-09-17",document:"<p>要写 nginx 配置文件，location 是一个比较重要的指令块，匹配到的 url 会执行对应 location 块中的语句，然而 location 匹配的类型有多种，经常会不记得不同类型的匹配规则，现在在此总结一下。</p>\n<h3>location 匹配类型</h3>\n<ol>\n<li>精确匹配 <code>=</code></li>\n<li>普通字符串匹配，无修饰符</li>\n<li>优先字符串匹配 <code>^~</code></li>\n<li>正则匹配 <code>~</code></li>\n<li>不区分大小写的正则匹配 <code>~*</code></li>\n</ol>\n<p>可以看到，大体分为两大类，一种是<strong>字符串</strong>类型（第1、2、3种类型），一种是<strong>正则</strong>类型（第4、5种类型），nginx 也是把两种类型分开处理的：先按顺序扫描字符串类型的 location 块，再按顺序扫描正则类型的 location 块，其中字符串类型都是区分大小写的。</p>\n<p>对于多个同级的 location 块，只会执行其中一个块的代码，下面说明 nginx 的匹配过程，即如何确定执行哪一个块。</p>\n<h3>匹配过程</h3>\n<p>先按顺序扫描字符串类型的 location 块：</p>\n<ol>\n<li>对于普通字符串匹配，会判断字符串是否匹配 url path 的<strong>开头</strong>，并且会记录所有成功匹配的普通字符串 location 中匹配长度最长的项，然后继续后续的匹配</li>\n<li>对于 <code>=</code> 精确匹配，会判断字符串是否<strong>完全等于</strong> url path，如果全等，则停止剩余 location 块的匹配，执行当前块</li>\n<li>对于 <code>^~</code> 优先字符串匹配，跟普通字符串匹配的规则是一样的，即判断字符串是否匹配 url path 的开头，不同的是如果匹配成功，则立即停止剩余 location 块的匹配，执行当前块</li>\n</ol>\n<p>如果匹配还未停止，则按顺序扫描正则类型的 location 块：</p>\n<ol>\n<li>对于正则匹配 <code>~</code>，如果匹配成功，则停止剩余 location 块的匹配，执行当前块</li>\n<li><code>~*</code> 跟 <code>~</code> 的规则是一样的，只是正则不区分大小写</li>\n</ol>\n<p>如果不存在能成功匹配的正则类型，则取之前记录的普通字符串匹配的匹配长度最长项的 location 块并执行。</p>\n<p>按照这个匹配过程，能总结出不同匹配类型的优先级：</p>\n<p><code>=</code> 精确匹配 = <code>^~</code> 优先字符串匹配 &gt; <code>~</code> 正则匹配 = <code>~*</code> 不区分大小写的正则匹配 &gt; 普通字符串匹配</p>\n<p>某些类型的 location 块的顺序是有意义的，对于那些立即停止的 location 匹配类型，顺序在前的则会优先匹配到，匹配成功则不再进行后续 location 块的匹配。例如对于正则匹配来说，如果有多个正则都能匹配某个 url path，则取顺序在最前的那个执行。但是对于普通字符串匹配来说，顺序则是无意义的，因为只会匹配到其中匹配成功的 location 块中字符串长度最长的那一个。</p>\n<h3>题外话</h3>\n<p>之前一直以为 <code>^~</code> 是某种正则匹配，因为它有个代表正则匹配的 ~ 号，其实不是，是字符串类型的匹配，^~ 符号的含义感觉可以理解成 “不要正则匹配”，即匹配成功了就不用进行后续正则的匹配了，用以区分跟普通字符串匹配的区别。^ 就是 “非” 的意思，就是我们平常写的正则表达式里方括号里面的 ^ 标识符。</p>\n"},{name:"large-file-resume",title:"Web 大文件上传浅析",modified_date:"2019-09-11",document:'<h2>普通方式上传大文件的痛点</h2>\n<p>上传大文件耗时比较久，普通的ajax、表单文件经常会遇到网络不稳定，不小心关掉浏览器等情况，再次上传时用户只能从头开始上传。如果有些需要上传几分钟甚至几小时的超大文件，用户将难以成功上传。第二点是后端一般都会有一些上传单个文件的大小限制，经典的例如 nginx 的 <code>client_max_body_size</code>，要上传大文件的话只能把这些值设置的很大，会带来一定的安全隐患</p>\n<h2>解决思路</h2>\n<p>在前端场景下，一些耗费性能的 js 任务可以使用 Event Loop 分片成子任务执行的方式解决，从而避免造成渲染阻塞。要上传大文件，可以采用相似的思路，把大文件拆分成数个小文件依次上传，后端把上传过来的这些小文件（<code>chunk</code>）按序拼接即可还原为源文件，这就引入了几个问题：</p>\n<ol>\n<li>如何将大文件拆分成 chunk</li>\n<li>如何保证 chunk 的顺序</li>\n<li>如何知道哪些 chunk 属于哪个源文件</li>\n</ol>\n<h3>文件拆分</h3>\n<p>利用 HTML5 的 Blob.slice API 可以实现文件拆分，文件对象 File 是 Blob 的子类，继承了 Blob 类的所有方法，该方法兼容IE10+的现代浏览器</p>\n<p>MDN：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/slice">https://developer.mozilla.org/zh-CN/docs/Web/API/Blob/slice</a></p>\n<p>兼容性：<a href="https://caniuse.com/#search=slice">https://caniuse.com/#search=slice</a></p>\n<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> chunk <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>startByte<span class="token punctuation">,</span> endByte<span class="token punctuation">,</span> file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>假设我们设置 chunk 的最大大小为 1MB，要上传一个 100.5 MB 的大文件就可以按字节顺序把文件拆分成 101 个 chunk，并记录每个 chunk 的序号，比如第 10 个 chunk 的序号就是 10，0 - 100 序号的 chunk 大小都为 1MB，101 序号的 chunk 大小为 0.5 MB。通过 101 个 ajax post 请求上传每个 chunk，并将 chunk 的序号作为请求参数。后端每收到一个 chunk，就检查该 chunk 的序号是否是上一个 chunk 的序号 + 1，如果是则把该 chunk 拼接到当前文件中，如果不是则继续监听请求。</p>\n<h3>文件 ID</h3>\n<p>到目前为止，后端还不知道当前 chunk 是属于哪一个源文件的，一旦有多个文件上传的请求就会出现混乱。因此需要给每个源文件定义一个文件 ID，作为 chunk 的请求参数传给后端。生成文件 ID 一个比较好的方案是 <code>md5(fileSize + fileName + userid)</code>，userid 可确保不同用户上传同名的文件不会混淆。</p>\n<h2>断点续传</h2>\n<p>有了文件分片，就可以实现断点续传。断点续传的意思就是传文件时出于各种原因中断传输，下次传相同的文件还可以从上次中断的地方继续传输，而不需要从头开始上传。实现方案是在每次上传 chunk 之前先发一个查询请求，查询准备上传的这个 chunk 的文件 id 和序号是否在后端的上传缓存中已存在，如果后端返回已存在，则跳过该 chunk 的 post 上传请求，进行下一个 chunk 的查询，依次如此。当然，当文件完全上传完毕后后端需要清除该文件的所有上传缓存。</p>\n<h2>Resumable.js</h2>\n<p>Resumable.js 是一个实现了大文件上传的很方便的库，支持断点续传、获取上传进度</p>\n<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> Resumable <span class="token keyword">from</span> <span class="token string">\'resumable.js\'</span>\n\n<span class="token keyword">function</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">{</span>\n    <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resumable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        target<span class="token punctuation">:</span> url<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    r<span class="token punctuation">.</span><span class="token function">addFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    r<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"fileAdded"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>file<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        r<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n<p><a href="https://github.com/23/resumable.js">https://github.com/23/resumable.js</a></p>\n'},{name:"canvas-concept",title:"canvas的一些概念",modified_date:"2019-01-13",document:'<p>canvas接触了挺久了，发现很多概念还是很模糊，比如路径、状态等等，经常搞混，因此现在总结和梳理一下。</p>\n<h2>路径</h2>\n<p>了解canvas的都知道，canvas上下文中的moveTo、lineTo、rect等方法可以创建路径，但什么是路径呢？</p>\n<p>就我理解，一条路径就是一系列点和这些点按一定顺序相连的一种抽象描述，和ps里的钢笔工具画出来的路径概念是一样的。</p>\n<p>canvas 里又有子路径的概念，每条子路径是一个单独的路径，不与其它路径相连接。一个路径中可以含有多个子路径。</p>\n<p>moveTo 的作用就是在当前路径下新建一条子路径，将指定的点作为子路径的起点</p>\n<p>lineTo 则是新建一个点，将这个点与当前的子路径相连。如果当前没有子路径，则作用与 moveTo 方法相同。</p>\n<p>注意，有些绘制路径的方法会主动新建子路径，比如 rect 方法，而有些则会像 lineTo 那样尽可能衔接已有的子路径，比如 arc 方法。</p>\n<p>至于 beginPath，这个方法的作用是在当前canvas上下文中创建一个新路径，把已存在的路径清除。路径的清除不会影响到已经使用fill、stroke等方法绘制上去的像素，只是内存中的路径抽象被销毁了，后续任何对路径的操作，比如使用fill、stroke进行渲染，都不会涉及到被清除的路径。</p>\n<p>closePath 这个方法，看上去似乎和 beginPath 异曲同工。其实它和 beginPath 的区别非常大，作用也不同，很容易搞混。它的作用是将当前子路径的末端点至首端点创建一条连线，此外没有任何其他作用，也并没有语义上的那种结束路径的作用。</p>\n<p>fill 填充、stroke 描边：对当前 canvas 上下文中的，即未被 beginPath 清除的路径和所有子路径进行填充渲染或描边渲染</p>\n<p>clip：作用是利用当前路径和所有子路径的填充区域生成裁剪区域，调用后所有的绘制操作只能在该区域中渲染出来。调用该方法不会对路径产生影响。</p>\n<h3>代码案例</h3>\n<h4>案例1</h4>\n<pre class="language-js"><code class="language-js">c<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'black\'</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-13%2021.45.55.png" alt="代码"></p>\n<p>只有一条子路径，调用stroke方法描边</p>\n<h4>案例2</h4>\n<pre class="language-js"><code class="language-js">c<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'black\'</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-13%2021.41.11.png" alt="代码"></p>\n<p>创建了两条子路径，子路径间不相连，调用stroke方法能将两条子路径都描边</p>\n<h4>案例3</h4>\n<pre class="language-js"><code class="language-js">c<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'black\'</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-13%2021.50.15.png" alt="代码"></p>\n<p>创建一条子路径后，beginPath清除路径，lineTo调用时发现不存在任何子路径，因此新建一条子路径。调用stroke方法只影响到存在的路径。</p>\n<h4>案例4</h4>\n<pre class="language-js"><code class="language-js">c<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'black\'</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-13%2021.56.39.png" alt="代码"></p>\n<p>closePath使得第二条子路径首尾相连，然后在20,60调用lineTo，发现路径仍然连着，调用closePath并不会结束和清除路径。</p>\n<h2>绘图状态</h2>\n<p>一个canvas上下文的绘图状态包含如下：</p>\n<ul>\n<li>变换矩阵：translate、rotate、scale、transform</li>\n<li>剪切区域：clip</li>\n<li>虚线列表</li>\n<li>渲染属性\n<ul>\n<li>描边、填充样式：strokeStyle、fillStyle</li>\n<li>线条设置：lineWidth、lineCap、lineJoin、miterLimit、lineDashOffset</li>\n<li>阴影设置：shadowOffsetX、shadowOffsetY、shadowBlur、shadowColor</li>\n<li>文本设置：font、textAlign、textBaseline、direction</li>\n<li>其它：globalAlpha、globalCompositeOperation、imageSmoothingEnabled</li>\n</ul>\n</li>\n</ul>\n<p>需要注意的是，路径不属于绘图状态的一部分。</p>\n<p>可以使用 save 和 restore 方法对绘图状态进行存取，canvas 内部实现了一个栈，调用 save 即把当前上下文的绘图状态对象 push 入栈，调用 restore 即是 pop 一个绘图状态对象出栈，然后将当前上下文的绘图状态替换为该绘图状态。</p>\n<p>使用save/restore能很方便地进行绘图状态的局部更新，而不会影响到全局。</p>\n<h4>案例</h4>\n<pre class="language-js"><code class="language-js">c<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'black\'</span>\nc<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">2</span>\n<span class="token comment">/**\n * 绘图状态1: {\n *    strokeStyle: \'black\',\n *    lineWidth: 2,\n * }\n **/</span>    \nc<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    \nc<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//保存绘图状态1</span>\n\nc<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">\'red\'</span>\n<span class="token comment">/**\n * 绘图状态2: {\n *    strokeStyle: \'red\',\n *    lineWidth: 2,\n * }\n **/</span>  \nc<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\nc<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//恢复成绘图状态1</span>\n\nc<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>\nc<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-13%2022.09.12.png" alt="代码"></p>\n'},{name:"compare-vue-react-rendering",title:"Vue和React的重渲染（re-render）机制对比",modified_date:"2018-12-15",document:'<p>Vue和React的其中一个最重要的区别是它们对于数据更新的管理方式不同，Vue基本上是一套基于getter/setter实现的依赖收集/依赖更新的订阅式机制，而React则是通过显式的触发函数调用来更新数据，比如setState。相比来说Vue的实现方式更细粒度一些， 通过依赖收集，Vue是能够知道一些数据的更新导致了哪些地方需要重新计算的，通过这种机制，Vue能够优雅地实现计算属性、watch，包括视图渲染。而React由于缺少这种细粒度的机制，则更多时候需要一些其它方案来提高性能，于是产生了如PureComponent、ImmutableJS、shouldComponentUpdate钩子等等。</p>\n<h3>如何触发组件重渲染？</h3>\n<ul>\n<li>\n<p>Vue：赋值data，如<code>this.value = 3</code></p>\n</li>\n<li>\n<p>React：<code>this.setState({value: 3})</code></p>\n</li>\n</ul>\n<p>其中的区别在于，Vue知道是组件数据中的value字段发生更新了， 而React只知道是组件的State发生了变化，并不知道是什么数据发生了变化。</p>\n<h3>Vue的重渲染</h3>\n<p>Vue的订阅式机制决定了它不仅知道哪些数据发生了更新，也知道这个数据更新了之后当前组件以及子组件的视图需不需要重新渲染。这是通过“依赖收集”实现的，Vue的视图template会编译成render函数，在数据（data/props/computed）中定义了getter，每次调用各个组件的render函数时，通过getter，就能知道哪些数据被哪些组件的视图所依赖，下一次对这些数据赋值时，也就是调用setter，相应的视图就能触发重渲染，而无关的组件则不需要再次调用render函数，节省了开销。借用Vue作者做的图：（他称之为push式渲染）</p>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/vue-push-rendering.png" alt="vue-push-rendering"></p>\n<p>举个例子：子组件Child使用了props<code>value</code>进行渲染，父组件Parent将data<code>value</code>作为props传递给了子组件Child，一秒后更新data。</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// Child.vue</span>\n<span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n\n<span class="token comment">// Parent.vue</span>\n<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n        props<span class="token punctuation">:</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nParent render\n<span class="token comment">//after 1000ms</span>\nChild render\nChild render\n</code></pre>\n<p>由于Parent组件和Child组件的视图都使用了Parent的data<code>value</code>，因此改变<code>value</code>的值，父子组件都会进行重渲染。</p>\n<p>情况二：<br>\n不将<code>value</code>作为props传给子组件Child，只用于组件自身视图：</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token comment">// Child.vue</span>\n<span class="token operator">&lt;</span>script<span class="token operator">></span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">"Child"</span><span class="token punctuation">,</span>\n  props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"value"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n\n<span class="token comment">// Parent.vue</span>\n<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">"./components/Child"</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Child <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>\n      <span class="token function">h</span><span class="token punctuation">(</span>Child<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">""</span>\n    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nChild render\n<span class="token comment">//after 1000ms</span>\nParent render \n</code></pre>\n<p>改变value后，父组件重渲染了，而子组件没有重渲染，因为子组件的render函数没有收集到Parent组件的数据<code>value</code>的依赖。</p>\n<h3>React的重渲染</h3>\n<p>当调用了<code>setState</code>，React并不在乎有什么数据发生了改变，接着触发组件的<code>shouldComponentUpdate</code>，如果返回true则调用<code>render</code>，然后以同样的办法依次更新所有子组件，如果返回<code>false</code>则阻止<code>render</code>方法调用及子组件更新。换句话说，更新视图的控制权由<code>shouldComponentUpdate</code>掌握，而默认情况下该方法返回<code>true</code>。（Vue作者称为pull式渲染）：</p>\n<p><img src="https://blog-1253663928.cos.ap-guangzhou.myqcloud.com/react-pull-rendering.png" alt="react-pull-rendering"></p>\n<p>看个例子：</p>\n<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token number">1</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        value<span class="token punctuation">:</span> <span class="token number">2</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Parent render"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>Child <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> rootElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> rootElement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre>\n<p>控制台打印：</p>\n<pre class="language-javascript"><code class="language-javascript">Parent render\nChild render\nParent render\nChild render\n</code></pre>\n<p>甚至视图什么数据都没使用，调用<code>setState</code>的组件及其子组件就都重渲染了。当组件或节点比较多的时候，更新数据可能会造成很多不必要的虚拟DOM的构建，庞大的节点树也拖慢了diff的速度，这时就需要引入一些优化方案，比如PureComponent配合ImutableJS， PureComponent利用<code>props</code>和<code>state</code>属性的浅对比来决定要不要重渲染，如果浅对比结果是相等，则组件及其子组件不参与重渲染。</p>\n'}]}}],error:null,serverRendered:!0}</script><script src="/_nuxt/09f7093c890e95b279ce.js" defer></script><script src="/_nuxt/6fc75a689514ac1b59d9.js" defer></script><script src="/_nuxt/304ca3ffca3eb968f2bf.js" defer></script><script src="/_nuxt/58d92c1aa04937a8a387.js" defer></script>
  </body>
</html>
